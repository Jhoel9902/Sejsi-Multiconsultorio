<div class="row justify-content-center">
  <div class="col-lg-8">
    <div class="card">
      <div class="card-body p-4">
        <h5 class="card-title mb-4"><i class="bi bi-person-plus me-2"></i>Registrar nuevo paciente</h5>

        <% if (error) { %>
          <div class="alert alert-danger"><%= error %></div>
        <% } %>

        <form method="post" action="/pacientes" class="needs-validation" novalidate accept-charset="UTF-8">
          <div class="row g-3">
            <!-- Datos personales -->
            <h6 class="col-12 mt-3 text-muted">Datos personales</h6>
            
            <div class="col-md-6">
              <label class="form-label">Nombre <span class="text-danger">*</span></label>
              <input type="text" class="form-control" name="nombre" value="<%= formData?.nombre || '' %>" required pattern="^[a-zA-ZáéíóúñÁÉÍÓÚÑ\s]+$" title="Solo letras y espacios" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Apellido paterno <span class="text-danger">*</span></label>
              <input type="text" class="form-control" name="apellido_paterno" value="<%= formData?.apellido_paterno || '' %>" required pattern="^[a-zA-ZáéíóúñÁÉÍÓÚÑ\s]+$" title="Solo letras y espacios" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Apellido materno</label>
              <input type="text" class="form-control" name="apellido_materno" value="<%= formData?.apellido_materno || '' %>" pattern="^[a-zA-ZáéíóúñÁÉÍÓÚÑ\s]*$" title="Solo letras y espacios" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Fecha de nacimiento <span class="text-danger">*</span></label>
              <input type="date" class="form-control" name="fecha_nacimiento" value="<%= formData?.fecha_nacimiento || '' %>" required />
              <small class="form-text text-muted">Debe ser menor de 100 años</small>
            </div>

            <!-- Documentos y contacto -->
            <h6 class="col-12 mt-3 text-muted">Documentos e identificación</h6>

            <div class="col-md-6">
              <label class="form-label">Cédula de identidad <span class="text-danger">*</span></label>
              <input type="text" class="form-control" name="ci" value="<%= formData?.ci || '' %>" required pattern="^[0-9]{7,8}[A-Z]?$" title="Formato: 7-8 dígitos + letra opcional" placeholder="Ej: 12345678 o 12345678A" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Correo electrónico</label>
              <input type="email" class="form-control" name="correo" value="<%= formData?.correo || '' %>" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Teléfono/Celular <span class="text-danger">*</span></label>
              <input type="tel" class="form-control" name="celular" value="<%= formData?.celular || '' %>" required pattern="^[0-9]{10,11}$" title="10-11 dígitos sin espacios" placeholder="Ej: 71234567" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Nacionalidad</label>
              <input type="text" class="form-control" name="nacionalidad" value="<%= formData?.nacionalidad || '' %>" />
            </div>

            <!-- Datos médicos y civiles -->
            <h6 class="col-12 mt-3 text-muted">Datos médicos y civiles</h6>

            <div class="col-md-4">
              <label class="form-label">Tipo de sangre</label>
              <select class="form-select" name="tipo_sangre">
                <option value="">-- Seleccionar --</option>
                <option value="O+" <%= formData?.tipo_sangre === 'O+' ? 'selected' : '' %>>O+</option>
                <option value="O-" <%= formData?.tipo_sangre === 'O-' ? 'selected' : '' %>>O-</option>
                <option value="A+" <%= formData?.tipo_sangre === 'A+' ? 'selected' : '' %>>A+</option>
                <option value="A-" <%= formData?.tipo_sangre === 'A-' ? 'selected' : '' %>>A-</option>
                <option value="B+" <%= formData?.tipo_sangre === 'B+' ? 'selected' : '' %>>B+</option>
                <option value="B-" <%= formData?.tipo_sangre === 'B-' ? 'selected' : '' %>>B-</option>
                <option value="AB+" <%= formData?.tipo_sangre === 'AB+' ? 'selected' : '' %>>AB+</option>
                <option value="AB-" <%= formData?.tipo_sangre === 'AB-' ? 'selected' : '' %>>AB-</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label">Estado civil</label>
              <select class="form-select" name="estado_civil">
                <option value="">-- Seleccionar --</option>
                <option value="Soltero/a" <%= formData?.estado_civil === 'Soltero/a' ? 'selected' : '' %>>Soltero/a</option>
                <option value="Casado/a" <%= formData?.estado_civil === 'Casado/a' ? 'selected' : '' %>>Casado/a</option>
                <option value="Divorciado/a" <%= formData?.estado_civil === 'Divorciado/a' ? 'selected' : '' %>>Divorciado/a</option>
                <option value="Viudo/a" <%= formData?.estado_civil === 'Viudo/a' ? 'selected' : '' %>>Viudo/a</option>
                <option value="Unión libre" <%= formData?.estado_civil === 'Unión libre' ? 'selected' : '' %>>Unión libre</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label">Contacto de emergencia</label>
              <input type="text" class="form-control" name="contacto_emerg" value="<%= formData?.contacto_emerg || '' %>" placeholder="Nombre y teléfono" />
            </div>

            <!-- Domicilio -->
            <h6 class="col-12 mt-3 text-muted">Domicilio</h6>

            <div class="col-12">
              <label class="form-label">Domicilio</label>
              <input type="text" class="form-control" name="domicilio" value="<%= formData?.domicilio || '' %>" />
            </div>

            <!-- Antecedentes médicos -->
            <h6 class="col-12 mt-3 text-muted">Antecedentes médicos</h6>

            <div class="col-12">
              <label class="form-label">Alergias</label>
              <textarea class="form-control" name="alergias" rows="2"><%= formData?.alergias || '' %></textarea>
            </div>
            <div class="col-12">
              <label class="form-label">Enfermedades base</label>
              <textarea class="form-control" name="enfermedad_base" rows="2"><%= formData?.enfermedad_base || '' %></textarea>
            </div>
            <div class="col-12">
              <label class="form-label">Observaciones</label>
              <textarea class="form-control" name="observaciones" rows="2"><%= formData?.observaciones || '' %></textarea>
            </div>

            <!-- Botones -->
            <div class="col-12 mt-4">
              <button type="submit" class="btn btn-primary me-2"><i class="bi bi-check-lg me-1"></i>Registrar</button>
              <a href="/pacientes" class="btn btn-outline-secondary"><i class="bi bi-x-lg me-1"></i>Cancelar</a>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
